# Stonks

# Overview
Category: Binary Exploitation

Points: 20

Competition: picoCTF 2021

# Description
I decided to try something noone else has before. I made a bot to automatically trade stonks for me using AI and machine learning. I wouldn't believe you if you told me it's unsecure! vuln.c `nc mercury.picoctf.net 16439`

# Solution
This challenge provides one file: `vuln.c`.

When the `buy_stonks` function is called, it gets the flag from an `api` file in the server, then stores it in char array `api_buf`, so the flag is stored in memory.

<img width="500" alt="image" src="https://github.com/jy-liew/CTF_Writeup/assets/138641379/58c16b32-9112-4f92-823d-775889b74be0"><br>

`malloc` is used to allocate memory of a specific size, in this case, 301 bytes, then the memory address of this allocated block of memory is stored in the `user_buf` char pointer.

<img width="350" alt="image" src="https://github.com/jy-liew/CTF_Writeup/assets/138641379/7f63b4a0-3286-4a0a-a0aa-c23d350e022b"><br>

`printf(user_buf)` presents a format string vulnerability. If `%x` is entered in the `scanf`, I can print a value from the stack in hexadecimal form.

<img width="400" alt="image" src="https://github.com/jy-liew/CTF_Writeup/assets/138641379/310adc5b-26a8-43b4-8a19-eea9dec6eed4"><br>

If multiple `%x` are entered, I can print multiple values from the stack and try to find the flag from those values.

<img width="613" alt="image" src="https://github.com/jy-liew/CTF_Writeup/assets/138641379/39246a7c-011f-4b38-9eb6-5eb39283704a"><br>

Pasting the hexadecimal values into Cyberchef to convert them to ASCII characters.

<img width="674" alt="Screenshot 2023-11-20 143934" src="https://github.com/jy-liew/CTF_Writeup/assets/138641379/ad5f4e88-00a2-493f-9808-54967c7094c5">





# Flag
picoCTF{I_l05t_4ll_my_m0n3y_c7cb6cae}
